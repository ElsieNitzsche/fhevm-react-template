<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anonymous Property Management Voting System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .header p {
            color: #718096;
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.8rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .status.connected {
            background: linear-gradient(135deg, #c6f6d5 0%, #9ae6b4 100%);
            color: #22543d;
            border: 2px solid #48bb78;
        }

        .status.disconnected {
            background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 100%);
            color: #742a2a;
            border: 2px solid #f56565;
        }

        .proposal-info {
            background: linear-gradient(135deg, #faf5ff 0%, #f7fafc 100%);
            border: 2px solid #d6bcfa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .proposal-info h3 {
            color: #553c9a;
            margin-bottom: 10px;
        }

        .voting-section {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .vote-btn {
            flex: 1;
            padding: 15px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .vote-yes {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .vote-no {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }

        .results-display {
            background: linear-gradient(135deg, #e6fffa 0%, #f0fff4 100%);
            border: 2px solid #4fd1c7;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .results-display h4 {
            color: #234e52;
            margin-bottom: 15px;
            text-align: center;
        }

        .result-bar {
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
            position: relative;
            height: 40px;
        }

        .result-fill {
            height: 100%;
            transition: width 0.8s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .result-fill.yes {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .result-fill.no {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }

        .timer {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
            margin: 15px 0;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .network-info {
            background: linear-gradient(135deg, #e6fffa 0%, #f0fff4 100%);
            border: 2px solid #4fd1c7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .network-info strong {
            color: #234e52;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }

            .voting-section {
                flex-direction: column;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fed7d7;
            color: #742a2a;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #f56565;
            margin: 15px 0;
        }

        .success-message {
            background: #c6f6d5;
            color: #22543d;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #48bb78;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Anonymous Property Voting System</h1>
            <p>Privacy-Preserving Community Decision Making Platform powered by Zama FHE Technology</p>
        </div>

        <!-- Network Information -->
        <div class="network-info">
            <strong>Network:</strong> Sepolia Testnet |
            <strong>Contract:</strong> 0xD30412C56d2E50dE333512Bd91664d98475E8eFf
        </div>

        <div class="main-content">
            <!-- Wallet Connection Section -->
            <div class="card">
                <h2>üîó Wallet Connection</h2>
                <div id="walletStatus" class="status disconnected">
                    Wallet Not Connected
                </div>
                <button id="connectWallet" class="btn">Connect MetaMask Wallet</button>
                <div id="accountInfo" style="margin-top: 15px; display: none;">
                    <strong>Account Address:</strong>
                    <div id="accountAddress" style="word-break: break-all; margin-top: 5px; font-family: monospace; background: #f7fafc; padding: 10px; border-radius: 5px;"></div>
                </div>
                <div id="networkWarning" style="display: none;" class="error-message">
                    ‚ö†Ô∏è Please switch to Sepolia Testnet to use this application
                </div>
            </div>

            <!-- Resident Registration Section -->
            <div class="card">
                <h2>üèòÔ∏è Resident Registration</h2>
                <div class="form-group">
                    <label for="unitNumber">Unit Number:</label>
                    <input type="number" id="unitNumber" min="1" max="200" placeholder="Enter your unit number (1-200)">
                </div>
                <button id="registerResident" class="btn">Register as Resident</button>
                <div id="residentStatus" style="margin-top: 15px;"></div>
            </div>

            <!-- Admin Proposal Creation Section -->
            <div class="card">
                <h2>‚öôÔ∏è Admin Functions</h2>
                <div class="form-group">
                    <label for="proposalTitle">Proposal Title:</label>
                    <input type="text" id="proposalTitle" placeholder="e.g., Community Fitness Equipment Upgrade">
                </div>
                <div class="form-group">
                    <label for="proposalDescription">Proposal Description:</label>
                    <textarea id="proposalDescription" rows="4" placeholder="Detailed description of the proposal and its purpose..."></textarea>
                </div>
                <div class="form-group">
                    <label for="votingDuration">Voting Duration (hours):</label>
                    <select id="votingDuration">
                        <option value="24">24 hours (1 day)</option>
                        <option value="48">48 hours (2 days)</option>
                        <option value="72" selected>72 hours (3 days)</option>
                        <option value="96">96 hours (4 days)</option>
                        <option value="120">120 hours (5 days)</option>
                        <option value="144">144 hours (6 days)</option>
                        <option value="168">168 hours (7 days)</option>
                    </select>
                </div>
                <button id="createProposal" class="btn btn-secondary">Create New Proposal</button>
            </div>

            <!-- Current Proposal Voting Section -->
            <div class="card">
                <h2>üó≥Ô∏è Current Voting</h2>
                <div id="proposalDisplay">
                    <div id="noProposal" style="text-align: center; color: #718096; padding: 40px 0;">
                        <p>üìã No active voting currently</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Voting Results Section -->
        <div class="card full-width">
            <h2>üìä Voting Results</h2>
            <div id="resultsSection">
                <p style="text-align: center; color: #718096; padding: 20px 0;">No voting results available</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        // Contract Configuration
        const CONTRACT_ADDRESS = "0xD30412C56d2E50dE333512Bd91664d98475E8eFf";
        const SEPOLIA_CHAIN_ID = "0xaa36a7"; // 11155111 in hex
        const CONTRACT_ABI = [
            "function registerResident(uint8 unitNumber) external",
            "function createProposal(string memory title, string memory description, uint256 votingDurationHours) external",
            "function submitVote(uint16 proposalId, uint8 voteChoice) external",
            "function endProposal(uint16 proposalId) external",
            "function getCurrentProposalInfo() external view returns (uint16, string, string, bool, uint256, uint256, uint16)",
            "function getResidentStatus(address resident) external view returns (bool, uint256, bool)",
            "function getProposalResults(uint16 proposalId) external view returns (bool, uint16, uint16, uint16, bool)",
            "function getTotalResidents() external view returns (uint256)",
            "function getVotingTimeLeft(uint16 proposalId) external view returns (uint256)",
            "function isVotingActive(uint16 proposalId) external view returns (bool)",
            "event ResidentRegistered(address indexed resident)",
            "event ProposalCreated(uint16 indexed proposalId, string title, uint256 endTime)",
            "event VoteSubmitted(address indexed voter, uint16 indexed proposalId)",
            "event ProposalEnded(uint16 indexed proposalId, uint16 yesVotes, uint16 noVotes)",
            "event ResultsRevealed(uint16 indexed proposalId, bool approved)"
        ];

        let provider;
        let signer;
        let contract;
        let userAddress;
        let currentProposalId = 0;
        let isCorrectNetwork = false;

        // Initialize the application
        async function init() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Check if already connected
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        await connectWallet();
                    }
                } catch (error) {
                    console.error('Init error:', error);
                }
            }

            // Set up periodic updates
            setInterval(updateVotingTimer, 1000);
            setInterval(loadCurrentProposal, 30000); // Refresh every 30 seconds
        }

        // Connect wallet function
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                showError('Please install MetaMask wallet');
                return;
            }

            try {
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();

                userAddress = await signer.getAddress();

                // Check network
                const network = await provider.getNetwork();
                isCorrectNetwork = network.chainId === 11155111; // Sepolia

                if (!isCorrectNetwork) {
                    document.getElementById('networkWarning').style.display = 'block';
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: SEPOLIA_CHAIN_ID }],
                        });
                        isCorrectNetwork = true;
                        document.getElementById('networkWarning').style.display = 'none';
                    } catch (switchError) {
                        console.error('Failed to switch network:', switchError);
                        return;
                    }
                }

                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                // Update UI
                document.getElementById('walletStatus').textContent = '‚úÖ Wallet Connected';
                document.getElementById('walletStatus').className = 'status connected';
                document.getElementById('accountInfo').style.display = 'block';
                document.getElementById('accountAddress').textContent = userAddress;
                document.getElementById('connectWallet').style.display = 'none';

                // Load data
                await loadCurrentProposal();
                await checkResidentStatus();

            } catch (error) {
                console.error('Wallet connection failed:', error);
                showError('Wallet connection failed: ' + error.message);
            }
        }

        // Register resident function
        async function registerResident() {
            const unitNumber = document.getElementById('unitNumber').value;
            if (!unitNumber || unitNumber < 1 || unitNumber > 200) {
                showError('Please enter a valid unit number (1-200)');
                return;
            }

            if (!isCorrectNetwork) {
                showError('Please switch to Sepolia Testnet');
                return;
            }

            try {
                const btn = document.getElementById('registerResident');
                btn.disabled = true;
                btn.innerHTML = 'Registering...<div class="loading"></div>';

                const tx = await contract.registerResident(parseInt(unitNumber));
                showSuccess('Transaction submitted. Waiting for confirmation...');

                await tx.wait();
                showSuccess('Resident registration successful!');
                await checkResidentStatus();

            } catch (error) {
                console.error('Registration failed:', error);
                showError('Registration failed: ' + (error.reason || error.message));
            } finally {
                const btn = document.getElementById('registerResident');
                btn.disabled = false;
                btn.innerHTML = 'Register as Resident';
            }
        }

        // Check resident status
        async function checkResidentStatus() {
            if (!contract || !userAddress) return;

            try {
                const [isRegistered, registrationTime, hasVoted] = await contract.getResidentStatus(userAddress);
                const statusDiv = document.getElementById('residentStatus');

                if (isRegistered) {
                    const regDate = new Date(registrationTime * 1000).toLocaleString();
                    statusDiv.innerHTML = `
                        <div class="success-message">
                            ‚úÖ Registered Resident<br>
                            Registration Time: ${regDate}<br>
                            Current Proposal Vote Status: ${hasVoted ? 'Voted' : 'Not Voted'}
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `
                        <div class="error-message">
                            ‚ùå Not registered yet. Please register as a resident first.
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Failed to check resident status:', error);
            }
        }

        // Create proposal function
        async function createProposal() {
            const title = document.getElementById('proposalTitle').value;
            const description = document.getElementById('proposalDescription').value;
            const duration = document.getElementById('votingDuration').value;

            if (!title || !description) {
                showError('Please fill in proposal title and description');
                return;
            }

            if (!isCorrectNetwork) {
                showError('Please switch to Sepolia Testnet');
                return;
            }

            try {
                const btn = document.getElementById('createProposal');
                btn.disabled = true;
                btn.innerHTML = 'Creating...<div class="loading"></div>';

                const tx = await contract.createProposal(title, description, parseInt(duration));
                showSuccess('Transaction submitted. Waiting for confirmation...');

                await tx.wait();
                showSuccess('Proposal created successfully!');
                await loadCurrentProposal();

                // Clear form
                document.getElementById('proposalTitle').value = '';
                document.getElementById('proposalDescription').value = '';

            } catch (error) {
                console.error('Proposal creation failed:', error);
                showError('Proposal creation failed: ' + (error.reason || error.message));
            } finally {
                const btn = document.getElementById('createProposal');
                btn.disabled = false;
                btn.innerHTML = 'Create New Proposal';
            }
        }

        // Load current proposal
        async function loadCurrentProposal() {
            if (!contract) return;

            try {
                const [proposalId, title, description, isActive, startTime, endTime, totalVotes] = await contract.getCurrentProposalInfo();
                currentProposalId = proposalId.toNumber();

                const proposalDisplay = document.getElementById('proposalDisplay');

                if (isActive && currentProposalId > 0) {
                    const startDate = new Date(startTime * 1000).toLocaleString();
                    const endDate = new Date(endTime * 1000).toLocaleString();

                    proposalDisplay.innerHTML = `
                        <div class="proposal-info">
                            <h3>üìã ${title}</h3>
                            <p style="margin-bottom: 10px;"><strong>Description:</strong></p>
                            <p style="margin-bottom: 15px;">${description}</p>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem; color: #666;">
                                <div><strong>Start Time:</strong> ${startDate}</div>
                                <div><strong>End Time:</strong> ${endDate}</div>
                                <div><strong>Total Votes:</strong> ${totalVotes}</div>
                                <div><strong>Proposal ID:</strong> #${currentProposalId}</div>
                            </div>
                        </div>
                        <div id="votingTimer" class="timer"></div>
                        <div class="voting-section">
                            <button class="btn vote-btn vote-yes" onclick="submitVote(1)">‚úÖ YES</button>
                            <button class="btn vote-btn vote-no" onclick="submitVote(0)">‚ùå NO</button>
                        </div>
                    `;

                    await updateVotingTimer();
                } else {
                    proposalDisplay.innerHTML = `
                        <div id="noProposal" style="text-align: center; color: #718096; padding: 40px 0;">
                            <p>üìã No active voting currently</p>
                        </div>
                    `;
                }

                // Load voting results
                await loadResults();

            } catch (error) {
                console.error('Failed to load proposal:', error);
            }
        }

        // Submit vote function
        async function submitVote(voteChoice) {
            if (!contract || !userAddress) {
                showError('Please connect your wallet first');
                return;
            }

            if (!isCorrectNetwork) {
                showError('Please switch to Sepolia Testnet');
                return;
            }

            try {
                // Check if registered
                const [isRegistered] = await contract.getResidentStatus(userAddress);
                if (!isRegistered) {
                    showError('Please register as a resident first');
                    return;
                }

                // Check if already voted
                const [, , hasVoted] = await contract.getResidentStatus(userAddress);
                if (hasVoted) {
                    showError('You have already voted on this proposal');
                    return;
                }

                const voteText = voteChoice === 1 ? 'YES' : 'NO';
                const confirmVote = confirm(`Confirm your vote: ${voteText}?\n\nNote: Vote cannot be changed once submitted!`);

                if (!confirmVote) return;

                const tx = await contract.submitVote(currentProposalId, voteChoice);
                showSuccess('Vote submitted. Waiting for confirmation...');

                await tx.wait();
                showSuccess('Vote submitted successfully!');

                await loadCurrentProposal();
                await checkResidentStatus();

            } catch (error) {
                console.error('Vote submission failed:', error);
                showError('Vote submission failed: ' + (error.reason || error.message));
            }
        }

        // Update voting timer
        async function updateVotingTimer() {
            if (!contract || currentProposalId === 0) return;

            try {
                const timeLeft = await contract.getVotingTimeLeft(currentProposalId);
                const timerElement = document.getElementById('votingTimer');

                if (timerElement && timeLeft > 0) {
                    const hours = Math.floor(timeLeft / 3600);
                    const minutes = Math.floor((timeLeft % 3600) / 60);
                    const seconds = timeLeft % 60;

                    timerElement.innerHTML = `‚è∞ Time Remaining: ${hours}h ${minutes}m ${seconds}s`;
                } else if (timerElement) {
                    timerElement.innerHTML = `‚è∞ Voting Period Ended`;

                    // Disable voting buttons
                    const voteBtns = document.querySelectorAll('.vote-btn');
                    voteBtns.forEach(btn => {
                        btn.disabled = true;
                        btn.style.opacity = '0.5';
                    });
                }
            } catch (error) {
                console.error('Failed to update timer:', error);
            }
        }

        // Load voting results
        async function loadResults() {
            if (!contract || currentProposalId === 0) return;

            try {
                const [resultsRevealed, totalVotes, yesVotes, noVotes, approved] = await contract.getProposalResults(currentProposalId);
                const resultsSection = document.getElementById('resultsSection');

                if (resultsRevealed && totalVotes > 0) {
                    const yesPercentage = totalVotes > 0 ? (yesVotes / totalVotes * 100).toFixed(1) : 0;
                    const noPercentage = totalVotes > 0 ? (noVotes / totalVotes * 100).toFixed(1) : 0;

                    resultsSection.innerHTML = `
                        <div class="results-display">
                            <h4>üìä Voting Results - ${approved ? '‚úÖ APPROVED' : '‚ùå REJECTED'}</h4>
                            <div style="margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span><strong>‚úÖ YES Votes</strong></span>
                                    <span>${yesVotes} votes (${yesPercentage}%)</span>
                                </div>
                                <div class="result-bar">
                                    <div class="result-fill yes" style="width: ${yesPercentage}%">
                                        ${yesVotes} votes
                                    </div>
                                </div>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span><strong>‚ùå NO Votes</strong></span>
                                    <span>${noVotes} votes (${noPercentage}%)</span>
                                </div>
                                <div class="result-bar">
                                    <div class="result-fill no" style="width: ${noPercentage}%">
                                        ${noVotes} votes
                                    </div>
                                </div>
                            </div>
                            <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #e2e8f0;">
                                <p><strong>Total Votes:</strong> ${totalVotes}</p>
                                <p style="margin-top: 5px; color: ${approved ? '#38a169' : '#e53e3e'}; font-weight: bold;">
                                    Result: ${approved ? 'Proposal APPROVED üéâ' : 'Proposal REJECTED üòî'}
                                </p>
                            </div>
                        </div>
                    `;
                } else {
                    resultsSection.innerHTML = `
                        <p style="text-align: center; color: #718096; padding: 20px 0;">
                            ${currentProposalId > 0 ? 'Voting in progress, results not yet revealed' : 'No voting results available'}
                        </p>
                    `;
                }
            } catch (error) {
                console.error('Failed to load results:', error);
            }
        }

        // Utility functions for messages
        function showError(message) {
            // Remove existing messages
            const existingMessages = document.querySelectorAll('.error-message, .success-message');
            existingMessages.forEach(msg => {
                if (!msg.closest('#residentStatus')) {
                    msg.remove();
                }
            });

            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            document.querySelector('.container').insertBefore(errorDiv, document.querySelector('.main-content'));

            setTimeout(() => errorDiv.remove(), 5000);
        }

        function showSuccess(message) {
            // Remove existing messages
            const existingMessages = document.querySelectorAll('.error-message, .success-message');
            existingMessages.forEach(msg => {
                if (!msg.closest('#residentStatus')) {
                    msg.remove();
                }
            });

            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.textContent = message;
            document.querySelector('.container').insertBefore(successDiv, document.querySelector('.main-content'));

            setTimeout(() => successDiv.remove(), 5000);
        }

        // Event listeners
        document.getElementById('connectWallet').addEventListener('click', connectWallet);
        document.getElementById('registerResident').addEventListener('click', registerResident);
        document.getElementById('createProposal').addEventListener('click', createProposal);

        // Listen for account changes
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    location.reload();
                } else {
                    location.reload();
                }
            });

            window.ethereum.on('chainChanged', (chainId) => {
                location.reload();
            });
        }

        // Initialize when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>